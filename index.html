<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Typing Trainer</title>
  <style>
    /* --- Design Tokens --- */
    :root {
      --bg: #0f1220;
      --card: #151932;
      --muted: #8c93b2;
      --text: #e8ecff;
      --accent: #6aa4ff;
      --accent-2: #7cf5b1;
      --bad: #ff6b6b;
      --good: #7cf5b1;
      --border: #22274a;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    .light {
      --bg: #f6f7fb;
      --card: #ffffff;
      --muted: #5f6b85;
      --text: #0f1220;
      --accent: #2962ff;
      --accent-2: #00c853;
      --bad: #e53935;
      --good: #00c853;
      --border: #e8eaf6;
      --shadow: 0 8px 28px rgba(16, 24, 40, 0.12);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 80% -10%, rgba(106,164,255,0.20), transparent 45%),
                  radial-gradient(1200px 800px at -10% 110%, rgba(124,245,177,0.18), transparent 45%),
                  var(--bg);
      color: var(--text);
      transition: background 300ms ease, color 300ms ease;
    }

    .container {
      max-width: 980px; margin: 0 auto; padding: 24px; 
    }

    header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 18px;
    }

    .brand {
      display: flex; align-items: center; gap: 12px;
    }
    .logo {
      width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow: var(--shadow);
    }
    h1 { font-size: 22px; margin: 0; letter-spacing: 0.3px; }
    .muted { color: var(--muted); font-size: 14px; }

    .controls {
      display: grid; grid-template-columns: repeat(4, minmax(120px, 1fr)); gap: 12px;
    }
    .control {
      background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 12px 14px; 
      display: flex; align-items: center; gap: 10px; box-shadow: var(--shadow);
    }
    .control label { font-size: 12px; color: var(--muted); display: block; }
    select, button, input[type="checkbox"] { font: inherit; }
    select, button {
      padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border); background: transparent; color: var(--text);
    }
    button.primary { background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #0b1020; border: none; font-weight: 700; }
    button:disabled { opacity: .6; cursor: not-allowed; }

    .panel {
      background: var(--card); border: 1px solid var(--border); border-radius: 18px; padding: 18px; margin-top: 16px; box-shadow: var(--shadow);
    }

    .prompt {
      min-height: 120px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 18px; line-height: 1.6; padding: 16px; border-radius: 12px; background: rgba(255,255,255,0.02); border: 1px dashed var(--border);
      user-select: none;
    }
    .ch.future { color: var(--muted); opacity: 0.6; }
    .ch.correct { color: var(--good); }
    .ch.incorrect { color: var(--bad); text-decoration: underline wavy currentColor; }

    .input {
      width: 100%; margin-top: 12px; padding: 14px 16px; border-radius: 12px; border: 1px solid var(--border); background: rgba(0,0,0,0.15);
      color: var(--text); font-size: 18px; outline: none;
    }

    .stats {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 14px;
    }
    .stat {
      background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 12px 14px; text-align: center; box-shadow: var(--shadow);
    }
    .stat .label { font-size: 12px; color: var(--muted); }
    .stat .value { font-size: 22px; font-weight: 800; margin-top: 4px; }

    .progress {
      height: 10px; background: rgba(255,255,255,0.08); border-radius: 999px; overflow: hidden; margin-top: 12px;
    }
    .bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); transition: width 120ms ease; }

    .footer { display: flex; justify-content: space-between; align-items: center; margin-top: 16px; }

    .theme-toggle { display: flex; align-items: center; gap: 8px; cursor: pointer; }

    /* Modal */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(10, 12, 20, 0.6); display: none; place-items: center; }
    .modal { background: var(--card); border: 1px solid var(--border); border-radius: 18px; padding: 20px; width: min(520px, 92vw); box-shadow: var(--shadow); }
    .modal h2 { margin: 0 0 8px; font-size: 22px; }
    .scores { display: grid; grid-template-columns: repeat(2,1fr); gap: 10px; margin-top: 12px; }
    .score-card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; padding: 12px; text-align: center; }

    @media (max-width: 720px) {
      .controls { grid-template-columns: 1fr 1fr; }
      .stats { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="container" id="app">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Whats your WPM?</h1>
          <div class="muted">Made by Iesa Kamran · Live WPM · Accuracy · Dark mode</div>
        </div>
      </div>
      <label class="theme-toggle">
        <input type="checkbox" id="themeToggle" />
        <span class="muted">Light theme</span>
      </label>
    </header>

    <section class="controls">
      <div class="control">
        <div style="flex:1">
          <label for="mode">Mode</label>
          <select id="mode">
            <option value="quote">Quote mode</option>
            <option value="timed">Timed 30s</option>
          </select>
        </div>
      </div>
      <div class="control">
        <div style="flex:1">
          <label for="difficulty">Difficulty</label>
          <select id="difficulty">
            <option value="short">Short</option>
            <option value="medium" selected>Medium</option>
            <option value="long">Long</option>
          </select>
        </div>
      </div>
      <div class="control">
        <div style="flex:1">
          <label>High Score (WPM)</label>
          <div id="highScore" class="muted">—</div>
        </div>
      </div>
      <div class="control" style="justify-content:flex-end">
        <button id="btnStart" class="primary">Start ▶</button>
      </div>
    </section>

    <section class="panel" aria-live="polite">
      <div id="prompt" class="prompt" aria-label="Typing prompt"></div>
      <input id="input" class="input" placeholder="Start typing here…" autocomplete="off" spellcheck="false" />
      <div class="progress"><div id="bar" class="bar"></div></div>

      <div class="stats">
        <div class="stat"><div class="label">WPM</div><div id="wpm" class="value">0.0</div></div>
        <div class="stat"><div class="label">Accuracy</div><div id="acc" class="value">100%</div></div>
        <div class="stat"><div class="label">Mistakes</div><div id="mistakes" class="value">0</div></div>
        <div class="stat"><div class="label">Time</div><div id="time" class="value">0.0s</div></div>
      </div>

      <div class="footer">
        <div class="muted">Tip: press <b>Enter</b> for a new prompt, <b>Esc</b> to reset the current round.</div>
        <div>
          <button id="btnNew">New Text ↻</button>
          <button id="btnReset">Reset ⎌</button>
        </div>
      </div>
    </section>
  </div>

  <!-- Results Modal -->
  <div class="modal-backdrop" id="backdrop">
    <div class="modal">
      <h2>Results</h2>
      <div class="scores">
        <div class="score-card">
          <div class="label">WPM</div>
          <div id="resWpm" class="value">0.0</div>
        </div>
        <div class="score-card">
          <div class="label">Accuracy</div>
          <div id="resAcc" class="value">0%</div>
        </div>
        <div class="score-card">
          <div class="label">Keystrokes</div>
          <div id="resKeys" class="value">0</div>
        </div>
        <div class="score-card">
          <div class="label">Time</div>
          <div id="resTime" class="value">0.0s</div>
        </div>
      </div>
      <div style="margin-top:14px; display:flex; gap:10px; justify-content:flex-end">
        <button id="btnClose">Close</button>
        <button id="btnPlayAgain" class="primary">Play again ▶</button>
      </div>
    </div>
  </div>

  <script>
    // --- Prompt bank ---
    const PROMPTS = {
      short: [
        "Practice makes progress.",
        "Stay curious and keep typing.",
        "Small steps lead to big wins.",
        "Clean code helps future you.",
        "Errors show that you are trying.",
      ],
      medium: [
        "Typing is a skill that grows with patience and consistency.",
        "Focus on accuracy first; speed will follow naturally over time.",
        "Debugging is like being a detective in a crime movie where you are also the culprit.",
        "Write code for humans to read and machines to execute.",
      ],
      long: [
        "Great software is built by taking small, deliberate steps and improving a little each day. Keep your focus on learning rather than perfection.",
        "Consistency beats intensity. Ten minutes of mindful practice each day will outpace a single hour of rushed work on the weekend.",
      ]
    };

    // --- State ---
    const els = {
      prompt: document.getElementById('prompt'),
      input: document.getElementById('input'),
      wpm: document.getElementById('wpm'),
      acc: document.getElementById('acc'),
      mistakes: document.getElementById('mistakes'),
      time: document.getElementById('time'),
      bar: document.getElementById('bar'),
      mode: document.getElementById('mode'),
      difficulty: document.getElementById('difficulty'),
      btnStart: document.getElementById('btnStart'),
      btnNew: document.getElementById('btnNew'),
      btnReset: document.getElementById('btnReset'),
      themeToggle: document.getElementById('themeToggle'),
      highScore: document.getElementById('highScore'),
      // modal
      backdrop: document.getElementById('backdrop'),
      resWpm: document.getElementById('resWpm'),
      resAcc: document.getElementById('resAcc'),
      resKeys: document.getElementById('resKeys'),
      resTime: document.getElementById('resTime'),
      btnClose: document.getElementById('btnClose'),
      btnPlayAgain: document.getElementById('btnPlayAgain'),
    };

    let target = '';
    let startTime = 0;
    let timerId = null;
    let tickId = null;
    let ended = false;
    let mistakes = 0;
    let mode = 'quote';
    let secondsLeft = 30;

    // --- Utilities ---
    function sample(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function now(){ return performance.now(); }
    function seconds(ms){ return (ms/1000); }

    function calcStats(typed, target, elapsedMs){
      const totalTyped = typed.length;
      let correct = 0;
      for (let i=0; i<typed.length; i++) {
        if (typed[i] === target[i]) correct++;
      }
      const accuracy = totalTyped ? Math.max(0, Math.min(100, (correct/totalTyped)*100)) : 100;
      const minutes = Math.max(0.001, seconds(elapsedMs)/60);
      const wpm = (totalTyped/5) / minutes; // gross WPM (simple and beginner friendly)
      return { wpm, accuracy, correct };
    }

    function renderPrompt(typed){
      let html='';
      for (let i=0; i<target.length; i++) {
        const t = typed[i];
        const ch = target[i];
        let cls = 'future';
        if (t !== undefined) {
          cls = (t === ch) ? 'correct' : 'incorrect';
        }
        const esc = ch
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
        html += `<span class="ch ${cls}">${esc}</span>`;
      }
      els.prompt.innerHTML = html;
    }

    function updateHighScoreUI(){
      const key = `highscore_${mode}_${els.difficulty.value}`;
      const value = localStorage.getItem(key);
      els.highScore.textContent = value ? `${parseFloat(value).toFixed(1)} WPM` : '—';
    }

    function trySetHighScore(wpm){
      const key = `highscore_${mode}_${els.difficulty.value}`;
      const prev = parseFloat(localStorage.getItem(key) || '0');
      if (!prev || wpm > prev) {
        localStorage.setItem(key, String(wpm));
      }
      updateHighScoreUI();
    }

    function resetRound(newPrompt=true){
      if (tickId) cancelAnimationFrame(tickId);
      if (timerId) clearInterval(timerId);
      ended = false; mistakes = 0; secondsLeft = 30; els.time.textContent = '0.0s';
      els.mistakes.textContent = '0';
      els.wpm.textContent = '0.0';
      els.acc.textContent = '100%';
      els.bar.style.width = '0%';
      if (newPrompt) {
        target = sample(PROMPTS[els.difficulty.value]);
        renderPrompt('');
      }
      els.input.value = '';
    }

    function startRound(){
      resetRound(false);
      startTime = now();
      const typed = els.input.value;
      if (mode === 'timed') {
        secondsLeft = 30; els.time.textContent = secondsLeft.toFixed(1) + 's';
        timerId = setInterval(() => {
          secondsLeft -= 0.1;
          els.time.textContent = Math.max(0, secondsLeft).toFixed(1) + 's';
          if (secondsLeft <= 0) finish();
        }, 100);
      }
      tick();
    }

    function finish(){
      if (ended) return;
      ended = true;
      if (tickId) cancelAnimationFrame(tickId);
      if (timerId) clearInterval(timerId);
      const elapsed = now() - startTime;
      const typed = els.input.value;
      const { wpm, accuracy } = calcStats(typed, target, elapsed);
      trySetHighScore(wpm);
      // populate modal
      els.resWpm.textContent = wpm.toFixed(1);
      els.resAcc.textContent = `${accuracy.toFixed(0)}%`;
      els.resKeys.textContent = String(typed.length);
      els.resTime.textContent = `${seconds(elapsed).toFixed(1)}s`;
      els.backdrop.style.display = 'grid';
    }

    function tick(){
      const typed = els.input.value;
      const elapsed = now() - startTime;
      const { wpm, accuracy } = calcStats(typed, target, elapsed);
      renderPrompt(typed);
      els.wpm.textContent = wpm.toFixed(1);
      els.acc.textContent = `${accuracy.toFixed(0)}%`;
      // progress
      const progress = Math.min(100, (typed.length / Math.max(1, target.length)) * 100);
      els.bar.style.width = progress + '%';
      // mistakes
      let wrong = 0; for (let i=0; i<typed.length; i++) if (typed[i] !== target[i]) wrong++;
      els.mistakes.textContent = String(wrong);
      // time (for quote mode, show elapsed; for timed, secondsLeft is handled separately)
      if (mode === 'quote') els.time.textContent = seconds(elapsed).toFixed(1) + 's';
      // finish conditions
      if (mode === 'quote' && typed.length >= target.length) { finish(); return; }
      tickId = requestAnimationFrame(tick);
    }

    // --- Events ---
    els.btnStart.addEventListener('click', () => {
      startRound(); els.input.focus();
    });

    els.btnNew.addEventListener('click', () => { target = sample(PROMPTS[els.difficulty.value]); renderPrompt(''); els.input.value=''; els.input.focus(); });
    els.btnReset.addEventListener('click', () => { resetRound(); els.input.focus(); });

    els.input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); target = sample(PROMPTS[els.difficulty.value]); renderPrompt(''); els.input.value=''; return; }
      if (e.key === 'Escape') { e.preventDefault(); resetRound(); return; }
    });

    els.input.addEventListener('input', () => {
      if (!startTime) startRound();
    });

    els.mode.addEventListener('change', () => { mode = els.mode.value; updateHighScoreUI(); resetRound(); els.input.focus(); });
    els.difficulty.addEventListener('change', () => { updateHighScoreUI(); target = sample(PROMPTS[els.difficulty.value]); renderPrompt(''); els.input.focus(); });

    // Theme
    const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
    function applyTheme(light){ document.body.classList.toggle('light', light); }
    els.themeToggle.addEventListener('change', () => applyTheme(els.themeToggle.checked));
    applyTheme(prefersLight); els.themeToggle.checked = prefersLight;

    // Modal events
    els.btnClose.addEventListener('click', () => { els.backdrop.style.display = 'none'; });
    els.btnPlayAgain.addEventListener('click', () => { els.backdrop.style.display = 'none'; resetRound(false); startRound(); els.input.focus(); });
    els.backdrop.addEventListener('click', (e) => { if (e.target === els.backdrop) els.backdrop.style.display = 'none'; });

    // Init
    mode = els.mode.value;
    updateHighScoreUI();
    target = sample(PROMPTS[els.difficulty.value]);
    renderPrompt('');
  </script>
</body>
</html>
